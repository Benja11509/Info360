@{
    ViewData["Title"] = "Perfil";
}

<link rel="stylesheet" href="~/css/perfil.css" asp-append-version="true" />


<div class="profile-card">
    <div class="profile-header">
        <div class="profile-picture-container">
            <img src="@ViewBag.usuario.fotoPerfil" alt="Foto de perfil" class="profile-picture" />
        </div>
        
        <a href='@Url.Action("Configuracion", "Home")' class="edit-profile-btn">Editar Perfil</a>
    </div>

    <div class="profile-info">
        <div class="info-group">
            <label class="info-label">Nombre de usuario:</label>
            <p class="info-value">@ViewBag.usuario.nombreUsuario</p>
        </div>

        <div class="info-group description-group">
            <label class="info-label">Descripción:</label>
            <p class="info-value">@ViewBag.usuario.descripcion</p>
        </div>

        @if (ViewBag.usuario.tipoUsuario == "tutor" && ViewBag.Vinculos.Count > 0)
        {
            <div class="info-group">
                <label class="info-label">Perteneciente/s:</label>
                <p class="info-value">@ViewBag.Vinculos[0].nombre @ViewBag.Vinculos[0].apellido</p>
            </div>
        }
        else if (ViewBag.usuario.tipoUsuario == "perteneciente" && ViewBag.Vinculos.Count > 0)
        {
            <div class="info-group">
                <label class="info-label">Tutor/es:</label>
                <p class="info-value">@ViewBag.Vinculos[0].nombre @ViewBag.Vinculos[0].apellido</p>
            </div>
        }

        @if(ViewBag.TocoMasPefil)
        {
            <div class="info-group">
                <label class="info-label">Nombre:</label>
                <p class="info-value">@ViewBag.usuario.nombre</p>
            </div>
            <div class="info-group">
                <label class="info-label">Apellido:</label>
                <p class="info-value">@ViewBag.usuario.apellido</p>
            </div>
            <div class="info-group">
                <label class="info-label">Email:</label>
                <p class="info-value">@ViewBag.usuario.mail</p>
            </div>
            <div class="info-group">
                <label class="info-label">Fecha de Nacimiento:</label>
                <p class="info-value">@ViewBag.usuario.fechaNacimiento?.ToString("dd/MM/yyyy")</p>
            </div>
            <div class="info-group">
                <label class="info-label">Teléfono:</label>
                <p class="info-value">@ViewBag.usuario.telefono</p>
            </div>
            <div class="info-group">
                <label class="info-label">Nivel de Apoyo:</label>
                <p class="info-value">@ViewBag.usuario.nivelApoyo</p>
            </div>
            <div class="info-group">
                <label class="info-label">Puntos:</label>
                <p class="info-value">@ViewBag.usuario.puntos</p>
            </div>
        
        }
        

            @if (ViewBag.usuario.tipoUsuario == "responsable")
{
    <section class="Perfil_Relaciones">
        <h3>Mis Pertenecientes Vinculados</h3>

   @foreach (Usuario perteneciente in ViewBag.Vinculos)//toma error porque recorro una lista vacia
        {
            <div class="vinculo-card">
                <p><strong>Nombre:</strong> @perteneciente.nombre @perteneciente.apellido</p>
                <p><strong>Email:</strong> @perteneciente.mail</p>
                <p><strong>Teléfono:</strong> @perteneciente.telefono</p>
                
                <form method="post" asp-action="EliminarVinculo" style="display:inline;">
                    <input type="hidden" name="idTutor" value="@ViewBag.usuario.id" />
                    <input type="text" name="nombreUsuarioPerteneciente" value="nombreUsuarioPerteneciente" />
                    <button type="submit" class="btn btn-danger btn-sm">Eliminar vínculo</button>
                </form>
            </div>
        }
        
        <hr class="seccion-divisor" />
        
        <h4>Agregar Nuevo Perteneciente</h4>
        <form method="post" asp-action="AgregarVinculo" class="vinculo-form">
            <div>
                <label for="idPerteneciente">Seleccionar usuario:</label>
                <select name="idPerteneciente" required>
                    @foreach (Usuario usuario in ViewBag.UsuariosDisponibles) //toma error porque recorro una lista vacia
                    {
                        <option value="@usuario.id">@usuario.nombre @usuario.apellido (@usuario.nombreUsuario)</option>
                    }
                </select>
            </div>

            <div>
                <label for="parentesco">Parentesco:</label>
                <input type="text" name="parentesco" required />
            </div>

            <input type="hidden" name="idTutor" value="@ViewBag.usuario.id" />
            <button type="submit" class="btn btn-primary mt-2">Agregar vínculo</button>
        </form>
    </section>
}
        <a href='@Url.Action(ViewBag.TocoMasPefil ? "Perfil" : "VerMasPerfil", "Home")' class="nav-link" >
            @(ViewBag.TocoMasPefil ? "Ver menos datos" : "Ver más datos")
        </a>
    </div>

    <div class="bubble bubble-tl"></div>
    <div class="bubble bubble-tr"></div>
    <div class="bubble bubble-bl"></div>
    <div class="bubble bubble-br"></div>
</div>

 <script src="js/site.js"></script>

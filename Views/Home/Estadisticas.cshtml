@using Info360.Models 

@{
    ViewData["Title"] = "Estadísticas";
    
    // --- 1. CONFIGURACIÓN ÚNICA PARA AMBOS GRÁFICOS ---
    List<TiempoDiario> tiemposRegistrados = ViewBag.TiempoDiario as List<TiempoDiario>; 
    int maxTiempoSegundos = 1; 
    
    if (tiemposRegistrados != null && tiemposRegistrados.Any())
    {
        maxTiempoSegundos = tiemposRegistrados.Max(t => t.Tiempo);
    }
}

<div class="container my-5">
    
    @* ============================================== *@
    @* GRÁFICO 1: TIEMPO COMPLETANDO ACTIVIDADES (Estructura Corregida) *@
    @* ============================================== *@
    <div class="board">
        <div class="titulo_grafica">
            <h3 class="t_grafica">Tiempo completando actividades</h3>
        </div>
        
        @if (tiemposRegistrados != null && tiemposRegistrados.Any())
        {
            @* CLAVE: Aplicamos FLEX para la alineación horizontal de las barras *@
            <div class="sub_board" style="display: flex; flex-direction: row; align-items: flex-end;">
                
                @* El bucle debe envolver TODOS los elementos que se repiten por barra (sep_board y cont_board) *@
                @foreach(var tiempoDiario in tiemposRegistrados.OrderBy(t => t.Fecha)) 
                { 
                    double porcentajeAltura = (double)tiempoDiario.Tiempo / maxTiempoSegundos * 100;
                    
                    <div class="sep_board"></div>
                    <div class="cont_board">
                        <div class="graf_board">
                            <div class="barra">
                                @* APLICAMOS ALTURA DINÁMICA y contenemos las etiquetas *@
                                <div class="sub_barra b1" style="height: @(porcentajeAltura.ToString("F0"))%;">
                                    
                                    <div class="tag_g">
                                        @tiempoDiario.TiempoNeto.ToString(@"hh\:mm\:ss")
                                    </div>
                                    
                                    <div class="tag_leyenda">
                                        @tiempoDiario.Fecha.ToString("dd/MM")
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        @* Eje Y (solo si tu CSS espera que se repita con cada barra) *@
                        <div class="tag_board">
                             <div class="sub_tag_board">
                                <div>100</div><div>90</div><div>80</div><div>70</div><div>60</div><div>50</div><div>40</div><div>30</div><div>20</div><div>10</div>
                            </div>
                        </div>
                    </div> 
                }
                <div class="sep_board"></div> @* Separador al final de la última barra *@
            </div>
        } else {
            <div class="sub_board"><div class="alert alert-info text-center" style="width: 100%;">No hay datos de tiempo para Actividades.</div></div>
        }
    </div> @* Cierra board 1 *@
    
    <hr class="my-5">
        
       



















<div class="board">
    <div class="titulo_grafica">
        <h3 class="t_grafica">Tiempo en Pantalla Registrado ⏱️</h3>
    </div>
    
    @if (tiemposRegistrados != null && tiemposRegistrados.Any())
    {
        <div class="sub_board" style="display: flex; flex-direction: row; align-items: flex-end;">
            
            @* Bucle ÚNICO para dibujar todas las barras del gráfico. *@
            @foreach(var tiempoDiario in tiemposRegistrados.OrderBy(t => t.Fecha)) 
            { 
                // La variable 'maxTiempoSegundos' y 'tiemposRegistrados' ya existen gracias al bloque de arriba.
                double porcentajeAltura = (double)tiempoDiario.Tiempo / maxTiempoSegundos * 100;
                
                <div class="sep_board"></div>
                
                <div class="cont_board">
                    <div class="graf_board">
                        <div class="barra">
                            <div class="sub_barra b1" style="height: @(porcentajeAltura.ToString("F0"))%;">
                                
                                <div class="tag_g">
                                    @tiempoDiario.TiempoNeto.ToString(@"hh\:mm\:ss")
                                </div>
                                
                                <div class="tag_leyenda">
                                    @tiempoDiario.Fecha.ToString("dd/MM")
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="tag_board">
                        <div class="sub_tag_board">
                            <div>100</div>
                            <div>90</div>
                            <div>80</div>
                            <div>70</div>
                            <div>60</div>
                            <div>50</div>
                            <div>40</div>
                            <div>30</div>
                            <div>20</div>
                            <div>10</div>
                        </div>
                    </div>
                </div> 
            }
            <div class="sep_board"></div>
        </div>
    }
    else
    {
        <div class="sub_board">
            <div class="alert alert-warning mt-4 text-center" style="width: 100%;">
                Aún no hay registros de tiempo en pantalla.
            </div>
        </div>
    }
</div>
        
    </div>
</div>